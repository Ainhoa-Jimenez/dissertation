---
title: "reactivation_stat"
author: "Ainhoa"
date: "2024-03-12"
output: html_document
---

All the graphs and stats for correlation between active hours and reactivation events

##Index
1-3 set working directory, load packages and load data

1.  Set working directory

```{r}
setwd("~/Library/CloudStorage/OneDrive-UniversityofEdinburgh/dissertation/dissertation/dissertation")
```

2.  Load packages

```{r, message=FALSE}
library(skimr)  # summary
library(tidyverse)
library(lubridate)  # dates management
library(gridExtra)  # arrange plots
library(patchwork)  # combine plots
library(hms)  # use function as.Time()
library(openxlsx) # write.xlsx 
library(ggpubr)  # combine plots
```
2.2. Creates functions

- Function for graph asthetics

```{r, echo= TRUE, results="hide"}
theme_graphs_env_cond <- function(){
  theme_classic() +
  theme(axis.text.x = element_text(angle = 90))+
   theme(axis.text = element_text(size = 11),  # Adjust the size as needed
          axis.title = element_text(size = 14),
        legend.text = element_text(size=14))
  }
```

3.  Load the data and see its structure

```{r}
data_reactivation <- read_csv("reactivation_r.csv")

skimr::skim(data_reactivation)  # see a summary of the whole data
str(data_reactivation)  # see the structure of each variable
tail(data_reactivation)  # view the last 6 rows of data
head(data_reactivation)  # view the first 6 rows of data

```
```{r}
data_reactivation_wide <- pivot_wider(data_reactivation,
                                      names_from = "sample",
                                      values_from = c("act_hours", "event_high", "events_low"))
```

4. Plot each relation to see if tehre is a pattern

4.1. Events low. Separating by sapmles
```{r}

(graph_correlation_events_low <- data_reactivation_wide %>% 
  ggplot()+
  geom_point(aes(events_low_X1, act_hours_X1, color = "Sample X1")) +  # Scatter plot for Sample X1
   
  geom_point(aes(events_low_X2, act_hours_X2, color = "Sample X2")) +  # Scatter plot for Sample X2
  geom_point(aes(events_low_X3, act_hours_X3, color = "Sample X3")) +  # Scatter plot for Sample X3
  geom_point(aes(events_low_X4, act_hours_X4, color = "Sample X4")) +  # Scatter plot for Sample X4
  geom_smooth(aes(x = events_low_X1, y = act_hours_X1, color = "Sample X1"), method = "lm", se = FALSE) +
  geom_smooth(aes(x = events_low_X2, y = act_hours_X2, color = "Sample X2"), method = "lm", se = FALSE) +
  geom_smooth(aes(x = events_low_X3, y = act_hours_X3, color = "Sample X3"), method = "lm", se = FALSE) +
  geom_smooth(aes(x = events_low_X4, y = act_hours_X4, color = "Sample X4"), method = "lm", se = FALSE) +
  labs(x = "\nNº of reactivation \nevents", y = "Nº of active hours") +  # Axis labels
  theme_graphs_env_cond() +  # Custom theme, assuming it's defined elsewhere
  scale_color_manual(values = c("Sample X1" = "darkgreen", "Sample X2" = "lightgreen", "Sample X3" = "#ff914d", "Sample X4" = "#119683")))  # Custom color scale
```

4.2. Events high. Separating by samples

```{r}

(graph_correlation_events_high <- data_reactivation_wide %>% 
  ggplot()+
  geom_point(aes(event_high_X1, act_hours_X1, color = "Sample X1")) +  # Scatter plot for Sample X1
  geom_point(aes(event_high_X2, act_hours_X2, color = "Sample X2")) +  # Scatter plot for Sample X2
  geom_point(aes(event_high_X3, act_hours_X3, color = "Sample X3")) +  # Scatter plot for Sample X3
  geom_point(aes(event_high_X4, act_hours_X4, color = "Sample X4")) +  # Scatter plot for Sample X4
  geom_smooth(aes(x = event_high_X1, y = act_hours_X1, color = "Sample X1"), method = "lm", se = FALSE) +
  geom_smooth(aes(x = event_high_X2, y = act_hours_X2, color = "Sample X2"), method = "lm", se = FALSE) +
  geom_smooth(aes(x = event_high_X3, y = act_hours_X3, color = "Sample X3"), method = "lm", se = FALSE) +
  geom_smooth(aes(x = event_high_X4, y = act_hours_X4, color = "Sample X4"), method = "lm", se = FALSE) +
  labs(x = "\nNº of reactivation \nevents", y = "Nº of active hours") +  # Axis labels
  theme_graphs_env_cond() +  # Custom theme, assuming it's defined elsewhere
  scale_color_manual(values = c("Sample X1" = "darkgreen", "Sample X2" = "lightgreen", "Sample X3" = "#ff914d", "Sample X4" = "#119683")))  # Custom color scale
```

4.3. Events high. Samples together
```{r}

(graph_correlation_events_high_total <- data_reactivation %>% 
  ggplot()+
  geom_point(aes(event_high, act_hours)) +  # Scatter plot for Sample X1
  geom_smooth(aes(x = event_high, y = act_hours, method = "lm", se = FALSE)) +
  labs(x = "\nNº of reactivation \nevents", y = "Nº of active hours") +  # Axis labels
  theme_graphs_env_cond())  # Custom theme, assuming it's defined elsewhere
  
```

4.4. Events low. Samples together
```{r}

(graph_correlation_events_low_total <- data_reactivation %>% 
  ggplot()+
  geom_point(aes(events_low, act_hours)) +  # Scatter plot for Sample X1
  geom_smooth(aes(x = events_low, y = act_hours, method = "lm", se = FALSE)) +
  labs(x = "\nNº of reactivation \nevents", y = "Nº of active hours") +  # Axis labels
  theme_graphs_env_cond())  # Custom theme, assuming it's defined elsewhere
  
```

5. Spearman Correlation

```{r}
corr_high_together <- cor.test(x = data_reactivation$event_high, y = data_reactivation$act_hours, method = 'spearman')
corr_high_together

corr_high_kendall_together <- cor.test(x = data_reactivation$event_high, y = data_reactivation$act_hours, method = 'kendall')
corr_high_kendall_together
#---
corr_low_together <- cor.test(x = data_reactivation$events_low, y = data_reactivation$act_hours, method = 'spearman')
corr_high_together

corr_low_kendall_together <- cor.test(x = data_reactivation$events_low, y = data_reactivation$act_hours, method = 'kendall')
corr_low_kendall
#---
corr_high_X1 <- cor.test(x = data_reactivation_wide$event_high_X1, y = data_reactivation_wide$act_hours_X1, method = 'spearman')
corr_high_X1

corr_high_kendall_X1 <- cor.test(x = data_reactivation_wide$event_high_X1, y = data_reactivation_wide$act_hours_X1, method = 'kendall')
corr_high_kendall_X1
#---
corr_high_X2 <- cor.test(x = data_reactivation_wide$event_high_X2, y = data_reactivation_wide$act_hours_X2, method = 'spearman')
corr_high_X2

corr_high_kendall_X2 <- cor.test(x = data_reactivation_wide$event_high_X2, y = data_reactivation_wide$act_hours_X2, method = 'kendall')
corr_high_kendall_X2
#---
corr_high_X3 <- cor.test(x = data_reactivation_wide$event_high_X3, y = data_reactivation_wide$act_hours_X3, method = 'spearman')
corr_high_X3

corr_high_kendall_X3 <- cor.test(x = data_reactivation_wide$event_high_X3, y = data_reactivation_wide$act_hours_X3, method = 'kendall')
corr_high_kendall_X3
#---
corr_high_X4 <- cor.test(x = data_reactivation_wide$event_high_X4, y = data_reactivation_wide$act_hours_X4, method = 'spearman')
corr_high_X1

corr_high_kendall_X4 <- cor.test(x = data_reactivation_wide$event_high_X4, y = data_reactivation_wide$act_hours_X4, method = 'kendall')
corr_high_kendall_X4

#---
corr_low_X1 <- cor.test(x = data_reactivation_wide$events_low_X1, y = data_reactivation_wide$act_hours_X1, method = 'spearman')
corr_low_X1

corr_low_kendall_X1 <- cor.test(x = data_reactivation_wide$events_low_X1, y = data_reactivation_wide$act_hours_X1, method = 'kendall')
corr_low_kendall_X1
#---
corr_low_X2 <- cor.test(x = data_reactivation_wide$events_low_X2, y = data_reactivation_wide$act_hours_X2, method = 'spearman')
corr_low_X2

corr_low_kendall_X2 <- cor.test(x = data_reactivation_wide$events_low_X2, y = data_reactivation_wide$act_hours_X2, method = 'kendall')
corr_low_kendall_X2
#---
corr_low_X3 <- cor.test(x = data_reactivation_wide$events_low_X3, y = data_reactivation_wide$act_hours_X3, method = 'spearman')
corr_low_X3

corr_low_kendall_X3 <- cor.test(x = data_reactivation_wide$events_low_X3, y = data_reactivation_wide$act_hours_X3, method = 'kendall')
corr_low_kendall_X3
#---
corr_low_X4 <- cor.test(x = data_reactivation_wide$events_low_X4, y = data_reactivation_wide$act_hours_X4, method = 'spearman')
corr_low_X1

corr_low_kendall_X4 <- cor.test(x = data_reactivation_wide$events_low_X4, y = data_reactivation_wide$act_hours_X4, method = 'kendall')
corr_low_kendall_X4

```


# Thallus temperature vs yield
(run code_calc_yield.Rmd first)

```{r}
data_corr_temp <- read_csv("correlation_temp.csv")

data_corr_temp_wide <- pivot_wider(data_corr_temp,
                                      names_from = "sample",
                                      values_from = c("act_hours", "av_temp", "av_temp_act"))
```

4. Plot each relation to see if tehre is a pattern

```{r}
(graph_correlation_temp <- data_corr_temp_wide %>% 
  ggplot()+
  geom_point(aes(a, act_hours_X1, color = "Sample X1")) +  # Scatter plot for Sample X1
   
  geom_point(aes(events_low_X2, act_hours_X2, color = "Sample X2")) +  # Scatter plot for Sample X2
  geom_point(aes(events_low_X3, act_hours_X3, color = "Sample X3")) +  # Scatter plot for Sample X3
  geom_point(aes(events_low_X4, act_hours_X4, color = "Sample X4")) +  # Scatter plot for Sample X4
  geom_smooth(aes(x = events_low_X1, y = act_hours_X1, color = "Sample X1"), method = "lm", se = FALSE) +
  geom_smooth(aes(x = events_low_X2, y = act_hours_X2, color = "Sample X2"), method = "lm", se = FALSE) +
  geom_smooth(aes(x = events_low_X3, y = act_hours_X3, color = "Sample X3"), method = "lm", se = FALSE) +
  geom_smooth(aes(x = events_low_X4, y = act_hours_X4, color = "Sample X4"), method = "lm", se = FALSE) +
  labs(x = "\nNº of reactivation \nevents", y = "Nº of active hours") +  # Axis labels
  theme_graphs_env_cond() +  # Custom theme, assuming it's defined elsewhere
  scale_color_manual(values = c("Sample X1" = "darkgreen", "Sample X2" = "lightgreen", "Sample X3" = "#ff914d", "Sample X4" = "#119683")))  # Custom color scale
```



